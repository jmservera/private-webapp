# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: private-webapp
hooks:
  preup:
    run: |
      echo "Setting up environment variables..."
      azd env set CLIENT_IP_ADDRESS $(curl ifconfig.me 2>/dev/null | tr -d '\r')
      echo "Done"
    interactive: true
    shell: sh
  postup:
    run: ./scripts/set-github-vars.sh
    interactive: true
  # predown:
  #   shell: sh
  #   run: |
  #     echo "Loading azd .env file from current environment"
  #     AZURE_RESOURCE_GHRUNNER_NAME=$(azd env get-value "AZURE_RESOURCE_GHRUNNER_NAME")
  #     RESOURCE_GROUP=$(azd env get-value "RESOURCE_GROUP")
  #     GITHUB_REPO_TOKEN=$(azd env get-value "GITHUB_REPO_TOKEN")
  #     echo "Cleaning up gh runner..."
  #     az vm run-command invoke  --command-id CleanUpRunner --name "${AZURE_RESOURCE_GHRUNNER_NAME}" -g "${RESOURCE_GROUP}" --scripts @scripts/uninstall-action-runner.sh --parameters GITHUB_REPO_TOKEN="${GITHUB_REPO_TOKEN}"
  #     echo "Done"
  #   interactive: true
# predeploy:
#   run: ./scripts/predeploy.sh
#   interactive: true
# services:
#   ghRunner:
#     project: src/github
#     host: containerapp
#     language: js
#     docker:
#       path: Dockerfile
