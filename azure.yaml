# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: private-webapp
hooks:
  preup:
    run: |
      echo "Setting up environment variables..."
      azd env set CLIENT_IP_ADDRESS $(curl ifconfig.me 2>/dev/null | tr -d '\r')
      USRNAME=$(az account show --query "user.name" -o tsv | tr -d '\r')
      azd env set USER_NAME $USRNAME      
      azd env set USER_SID $(az ad user show --id "$USRNAME" --query id -o tsv | tr -d '\r')
    interactive: true
    shell: sh
  postup:
    run: ./scripts/set-github-vars.sh
    interactive: true
# predeploy:
#   run: ./scripts/predeploy.sh
#   interactive: true
# services:
#   ghRunner:
#     project: src/github
#     host: containerapp
#     language: js
#     docker:
#       path: Dockerfile
